---
title: |
  ![](https://coes.cl/wp-content/uploads/2025/03/COES_Logo_azul.png){width=25% height=25%}  
  Multilevel Models
author: 
  - Technical assistant
date: "`r Sys.Date()`"
output:
    bookdown::html_document2:
          theme: yeti
          toc: yes
          toc_float: yes
          toc_collapsed: yes
          number_sections: yes
          
          
    
linkcolor: black
urlcolor: blue
execute:
  echo: false
  warning: false
---

```{r packages and data}

# Packages
pacman::p_load(
    tidyverse,
    haven,
    tidylog,
    texreg,
    sjPlot,
    glue,
    ggeffects
)

# Data
load("../../output/models/results_mm.RData")
```

```{r}
# Create custom names

model_labels <- c("Null", "Individual", "Contextual", "Full", "Interaction")

source("../../analysis/helpers/labels.R")
```

```{r}
# Create wrapper function

tab_mm <- function(model, type = "texreg") {
    if (type == "sjPlot") {
        sjPlot::tab_model(
            model,
            show.ci = FALSE,
            show.se = TRUE,
            pred.labels = coef_labels,
            dv.labels = model_labels
        )
    }

    if (type == "texreg") {
        texreg::htmlreg(
            model,
            custom.coef.names = coef_labels,
            custom.model.names = model_labels,
            bold = 0.05 # p < 0.05 en negrita
        )
    }
}

plot_int_mm <- function(model, vardep) {
    marginales <- ggpredict(model, terms = c("nse_barrio_norm", "new_class"))

    # grafico
    ggplot(marginales, aes(x = x, y = predicted, color = group)) +
        geom_line(size = 1.2) +
        geom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = group), alpha = 0.15, color = NA) +
        labs(
            x = "Neighborhood socioeconomic status (standardized)",
            y = paste0("Predicted ", vardep),
            color = "Class",
            fill = "Class"
        ) +
        theme_minimal(base_size = 14) +
        theme(
            legend.position = "top",
            panel.grid.minor = element_blank()
        )
}

```

# Introduction

This document...

## ELSOC 2016

::: panel-tabset
# Identification

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$identification)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$identification[[5]], "Identification")
```

# Friends

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$friends)
```

# Generalized trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$gen_trust)
```

# Trust in minorities

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$trust_minorities)
```

# Institutional trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$trust_inst)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$trust_inst[[5]], "Institutional trust")
```

# Interest in politics

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$interest_pol)

```

# Satisfaction with democracy

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$satisf_demo)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$satisf_demo[[5]], "Satisfaction with democracy")
```

# Conventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$conv_particip)
```

# Unconventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$unconv_particip)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$unconv_particip[[5]], "Unconventional participation")
```

# Egalitarianism

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$egalitarianism)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$egalitarianism[[5]], "Egalitarianism")
```

# Altruistic behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$altruistic)
```

# Prosocial behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$prosoc_behave)
```

```{r}
plot_int_mm(results_mm$elsoc_2016$prosoc_behave[[5]], "Prosocial behavior")
```

# Democracy support

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$democracy_support)
```

# Injustification of violence

```{r results='asis'}
tab_mm(results_mm$elsoc_2016$justif_violence)
```

:::

## ELSOC 2019

::: panel-tabset
# Identification

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$identification)
```

# Friends

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$friends)
```

# Generalized trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$gen_trust)
```

# Trust in minorities

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$trust_minorities)
```

# Institutional trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$trust_inst)
```

```{r}
plot_int_mm(results_mm$elsoc_2019$trust_inst[[5]], "Institutional trust")
```

# Interest in politics

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$interest_pol)

```

# Satisfaction with democracy

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$satisf_demo)
```

# Conventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$conv_particip)
```

# Unconventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$unconv_particip)
```

# Egalitarianism

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$egalitarianism)
```

# Altruistic behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$altruistic)
```

# Prosocial behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$prosoc_behave)
```

# Democracy support

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$democracy_support)
```

# Injustification of violence

```{r results='asis'}
tab_mm(results_mm$elsoc_2019$justif_violence)
```
:::

## ELSOC 2022

::: panel-tabset
# Identification

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$identification)
```

# Friends

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$friends)
```

# Generalized trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$gen_trust)
```

# Trust in minorities

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$trust_minorities)
```

# Institutional trust

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$trust_inst)
```

```{r}
plot_int_mm(results_mm$elsoc_2022$trust_inst[[5]], "Institutional trust")
```

# Interest in politics

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$interest_pol)

```

```{r}
plot_int_mm(results_mm$elsoc_2022$interest_pol[[5]], "Interest in politics")
```

# Satisfaction with democracy

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$satisf_demo)
```

# Conventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$conv_particip)
```

# Unconventional participation

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$unconv_particip)
```

```{r}
plot_int_mm(results_mm$elsoc_2022$unconv_particip[[5]], "Unconventional participation")
```

# Egalitarianism

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$egalitarianism)
```

# Altruistic behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$altruistic)
```

# Prosocial behavior

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$prosoc_behave)
```

# Democracy support

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$democracy_support)
```

# Injustification of violence

```{r results='asis'}
tab_mm(results_mm$elsoc_2022$justif_violence)
```
:::
