---
title: |
  ![](https://coes.cl/wp-content/uploads/2025/03/COES_Logo_azul.png){width=25% height=25%}  
  Class MCA and HCPC analysis
author: 
  - Technical assistant
date: "`r Sys.Date()`"
output:
    bookdown::html_document2:
          theme: yeti
          toc: yes
          toc_float: yes
          toc_collapsed: yes
          number_sections: yes
          
          
    
linkcolor: black
urlcolor: blue
execute:
  echo: false
  warning: false
---

```{r packages and data}

# Packages
pacman::p_load(
    tidyverse,
    haven,
    tidylog,
    texreg,
    rlang,
    sjPlot,
    glue,
    ggeffects,
    FactoMineR,
    factoextra,
    knitr,
    kableExtra,
    reactable
)

# Data
# load("output/models/results_mca_hcpc.RData")
load("../../output/models/results_mca_hcpc.RData")
```


```{r wrappers}

plot_mca <- function(obj){
  obj %>% 
  fviz_mca_var(repel = TRUE,
  col.var = "cos2",                # color = calidad de representación
  gradient.cols = c("#B3CDE3","#6497B1","#03396C"),
  ggtheme = theme_minimal()
  ) +
  ggtitle("MCA: categorías (Dim1 vs Dim2)") +
  theme(legend.position = "right")

}

plot_cluster <- function(obj){
  obj %>% 
  fviz_cluster(clust, geom = "point", main = "Factor map")
}

```

```{r desc cluster function}
process_tab_desc_clust <- function(obj) {
    # Save object
    cl_cat <- obj

    # Process object
    desc_all <- imap_dfr(cl_cat, ~ {
        as.data.frame(.x) %>%
            rownames_to_column("var") %>%
            mutate(cluster = .y)
    }) %>%
        relocate(cluster, var) %>%
        mutate(across(where(is.numeric), ~ round(., 2))) %>%
        separate(var,
            into = c("variable", "categoria"),
            sep = "=", fill = "right", extra = "merge"
        ) %>%
        mutate(categoria = if_else(is.na(categoria), variable, categoria)) %>%
        relocate(variable, categoria, .after = cluster)

    return(desc_all)
}

tab_desc_clust <- function(x, process = TRUE) {

    # Process if needed
    if (process) {
        x <- process_tab_desc_clust(x)
    }

    # Create interactive table
    reactable(
        x,
        groupBy = "cluster",
        searchable = TRUE,
        filterable = TRUE,
        striped = TRUE,
        highlight = TRUE,
        defaultPageSize = 12,
        columns = list(
            cluster   = colDef(name = "Cluster", filterable = TRUE),
            variable  = colDef(name = "Variable"),
            categoria = colDef(name = "Categoría"),
            `Cla/Mod` = colDef(name = "Cla/Mod"),
            `Mod/Cla` = colDef(name = "Mod/Cla"),
            Global    = colDef(name = "Global"),
            `p.value` = colDef(name = "p-valor"),
            `v.test`  = colDef(name = "v-test")
        )
    )
}
```

```{r}
tab_n_clust <- function(obj, wave) {
  tab_frq <- obj$data.clust$clust %>% sjmisc::frq(.)
  tab_frq[[1]] %>% select("val_{wave}" := val, "frq_{wave}" := frq, "prc_{wave}" := valid.prc)
  }

wrap_tab_n_clust <- function(class){
  tab <- map2(
    c("elsoc_2016", "elsoc_2019", "elsoc_2022"),
    c("w01", "w04", "w06"), 
    ~ tab_n_clust(results_all[[.x]][[class]]$clust, wave = .y)
    ) %>% 
    list_cbind() %>% 
    select(-c(val_w04, val_w06)) %>% 
    select(cluster = val_w01, ends_with("w01"), ends_with("w04"), ends_with("w06")) %>% 
    filter(row_number() <= n() - 1)

    return(tab)
}
```


```{r}
format_kable <- function(x, title = "Here goes some title!"){
  x %>% kable(
    caption = title
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE
  )
}

format_lines <- function(x){
  x %>% 
  column_spec(1, extra_css = "border-right: 2px solid #726c6c54;", include_thead = TRUE) %>% 
  column_spec(3, extra_css = "border-right: 2px solid #726c6c54;", include_thead = TRUE) %>% 
  column_spec(5, extra_css = "border-right: 2px solid #726c6c54;", include_thead = TRUE)
}

specific_col <- function(kbl, data, n, umbrale = 0, ...){
      kableExtra::column_spec(kbl, n, 
                  color = dplyr::case_when(
                  as.matrix(data[,n]) > umbrale ~ "darkblue",
                  as.matrix(data[,n]) < -umbrale ~ "red",
                  TRUE ~ "lightgrey"
                  ),
                  ...
                )
}
```

# Introduction

This document...

## ELSOC 2016

::: panel-tabset
# MCA

```{r}
plot_mca(results_all$elsoc_2016$class6$acm)
```

# Class 6

```{r results='asis'}
plot_cluster(results_all$elsoc_2016$class6$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category)
```

```{r}
e16c6c1 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 1)
e16c6c2 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 2)
e16c6c3 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 3)
e16c6c4 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 4)
e16c6c5 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 5)
e16c6c6 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e16c6c1$categoria[[1]]`** (*v_test = `r e16c6c1$v.test[[1]]`*); **`r e16c6c1$categoria[[2]]`** (*v_test = `r e16c6c1$v.test[[2]]`*) and **`r e16c6c1$categoria[[3]]`** (*v_test = `r e16c6c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e16c6c2$categoria[[1]]`** (*v_test = `r e16c6c2$v.test[[1]]`*); **`r e16c6c2$categoria[[2]]`** (*v_test = `r e16c6c2$v.test[[2]]`*) and **`r e16c6c2$categoria[[3]]`** (*v_test = `r e16c6c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e16c6c3$categoria[[1]]`** (*v_test = `r e16c6c3$v.test[[1]]`*); **`r e16c6c3$categoria[[2]]`** (*v_test = `r e16c6c3$v.test[[2]]`*) and **`r e16c6c3$categoria[[3]]`** (*v_test = `r e16c6c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e16c6c4$categoria[[1]]`** (*v_test = `r e16c6c4$v.test[[1]]`*); **`r e16c6c4$categoria[[2]]`** (*v_test = `r e16c6c4$v.test[[2]]`*) and **`r e16c6c4$categoria[[3]]`** (*v_test = `r e16c6c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e16c6c5$categoria[[1]]`** (*v_test = `r e16c6c5$v.test[[1]]`*); **`r e16c6c5$categoria[[2]]`** (*v_test = `r e16c6c5$v.test[[2]]`*) and **`r e16c6c5$categoria[[3]]`** (*v_test = `r e16c6c5$v.test[[3]]`*)

- Cluster 6 is characterized by an overrepresentation of: **`r e16c6c6$categoria[[1]]`** (*v_test = `r e16c6c6$v.test[[1]]`*); **`r e16c6c6$categoria[[2]]`** (*v_test = `r e16c6c6$v.test[[2]]`*) and **`r e16c6c6$categoria[[3]]`** (*v_test = `r e16c6c6$v.test[[3]]`*)


# Class 5

```{r results='asis'}
plot_cluster(results_all$elsoc_2016$class5$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category)
```

```{r}
e16c5c1 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 1)
e16c5c2 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 2)
e16c5c3 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 3)
e16c5c4 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 4)
e16c5c5 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 5)
e16c5c6 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e16c5c1$categoria[[1]]`** (*v_test = `r e16c5c1$v.test[[1]]`*); **`r e16c5c1$categoria[[2]]`** (*v_test = `r e16c5c1$v.test[[2]]`*) and **`r e16c5c1$categoria[[3]]`** (*v_test = `r e16c5c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e16c5c2$categoria[[1]]`** (*v_test = `r e16c5c2$v.test[[1]]`*); **`r e16c5c2$categoria[[2]]`** (*v_test = `r e16c5c2$v.test[[2]]`*) and **`r e16c5c2$categoria[[3]]`** (*v_test = `r e16c5c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e16c5c3$categoria[[1]]`** (*v_test = `r e16c5c3$v.test[[1]]`*); **`r e16c5c3$categoria[[2]]`** (*v_test = `r e16c5c3$v.test[[2]]`*) and **`r e16c5c3$categoria[[3]]`** (*v_test = `r e16c5c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e16c5c4$categoria[[1]]`** (*v_test = `r e16c5c4$v.test[[1]]`*); **`r e16c5c4$categoria[[2]]`** (*v_test = `r e16c5c4$v.test[[2]]`*) and **`r e16c5c4$categoria[[3]]`** (*v_test = `r e16c5c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e16c5c5$categoria[[1]]`** (*v_test = `r e16c5c5$v.test[[1]]`*); **`r e16c5c5$categoria[[2]]`** (*v_test = `r e16c5c5$v.test[[2]]`*) and **`r e16c5c5$categoria[[3]]`** (*v_test = `r e16c5c5$v.test[[3]]`*)

# Class 4

```{r results='asis'}
plot_cluster(results_all$elsoc_2016$class4$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2016$class4$clust$desc.var$category)
```

# Class 3

```{r results='asis'}
plot_cluster(results_all$elsoc_2016$class3$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2016$class3$clust$desc.var$category)
```

# Class 2

```{r results='asis'}
plot_cluster(results_all$elsoc_2016$class2$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2016$class2$clust$desc.var$category)
```

:::

## ELSOC 2019

::: panel-tabset
# MCA

```{r}
plot_mca(results_all$elsoc_2019$class6$acm)
```

# Class 6

```{r results='asis'}
plot_cluster(results_all$elsoc_2019$class6$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category)
```

```{r}
e19c6c1 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 1)
e19c6c2 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 2)
e19c6c3 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 3)
e19c6c4 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 4)
e19c6c5 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 5)
e19c6c6 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e19c6c1$categoria[[1]]`** (*v_test = `r e19c6c1$v.test[[1]]`*); **`r e19c6c1$categoria[[2]]`** (*v_test = `r e19c6c1$v.test[[2]]`*) and **`r e19c6c1$categoria[[3]]`** (*v_test = `r e19c6c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e19c6c2$categoria[[1]]`** (*v_test = `r e19c6c2$v.test[[1]]`*); **`r e19c6c2$categoria[[2]]`** (*v_test = `r e19c6c2$v.test[[2]]`*) and **`r e19c6c2$categoria[[3]]`** (*v_test = `r e19c6c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e19c6c3$categoria[[1]]`** (*v_test = `r e19c6c3$v.test[[1]]`*); **`r e19c6c3$categoria[[2]]`** (*v_test = `r e19c6c3$v.test[[2]]`*) and **`r e19c6c3$categoria[[3]]`** (*v_test = `r e19c6c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e19c6c4$categoria[[1]]`** (*v_test = `r e19c6c4$v.test[[1]]`*); **`r e19c6c4$categoria[[2]]`** (*v_test = `r e19c6c4$v.test[[2]]`*) and **`r e19c6c4$categoria[[3]]`** (*v_test = `r e19c6c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e19c6c5$categoria[[1]]`** (*v_test = `r e19c6c5$v.test[[1]]`*); **`r e19c6c5$categoria[[2]]`** (*v_test = `r e19c6c5$v.test[[2]]`*) and **`r e19c6c5$categoria[[3]]`** (*v_test = `r e19c6c5$v.test[[3]]`*)

- Cluster 6 is characterized by an overrepresentation of: **`r e19c6c6$categoria[[1]]`** (*v_test = `r e19c6c6$v.test[[1]]`*); **`r e19c6c6$categoria[[2]]`** (*v_test = `r e19c6c6$v.test[[2]]`*) and **`r e19c6c6$categoria[[3]]`** (*v_test = `r e19c6c6$v.test[[3]]`*)

# Class 5

```{r results='asis'}
plot_cluster(results_all$elsoc_2019$class5$clust)
```

```{r}
e19c5c1 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 1)
e19c5c2 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 2)
e19c5c3 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 3)
e19c5c4 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 4)
e19c5c5 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 5)
e19c5c6 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e19c5c1$categoria[[1]]`** (*v_test = `r e19c5c1$v.test[[1]]`*); **`r e19c5c1$categoria[[2]]`** (*v_test = `r e19c5c1$v.test[[2]]`*) and **`r e19c5c1$categoria[[3]]`** (*v_test = `r e19c5c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e19c5c2$categoria[[1]]`** (*v_test = `r e19c5c2$v.test[[1]]`*); **`r e19c5c2$categoria[[2]]`** (*v_test = `r e19c5c2$v.test[[2]]`*) and **`r e19c5c2$categoria[[3]]`** (*v_test = `r e19c5c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e19c5c3$categoria[[1]]`** (*v_test = `r e19c5c3$v.test[[1]]`*); **`r e19c5c3$categoria[[2]]`** (*v_test = `r e19c5c3$v.test[[2]]`*) and **`r e19c5c3$categoria[[3]]`** (*v_test = `r e19c5c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e19c5c4$categoria[[1]]`** (*v_test = `r e19c5c4$v.test[[1]]`*); **`r e19c5c4$categoria[[2]]`** (*v_test = `r e19c5c4$v.test[[2]]`*) and **`r e19c5c4$categoria[[3]]`** (*v_test = `r e19c5c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e19c5c5$categoria[[1]]`** (*v_test = `r e19c5c5$v.test[[1]]`*); **`r e19c5c5$categoria[[2]]`** (*v_test = `r e19c5c5$v.test[[2]]`*) and **`r e19c5c5$categoria[[3]]`** (*v_test = `r e19c5c5$v.test[[3]]`*)

```{r}
tab_desc_clust(results_all$elsoc_2019$class5$clust$desc.var$category)
```

# Class 4

```{r results='asis'}
plot_cluster(results_all$elsoc_2019$class4$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2019$class4$clust$desc.var$category)
```

# Class 3

```{r results='asis'}
plot_cluster(results_all$elsoc_2019$class3$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2019$class3$clust$desc.var$category)
```

# Class 2

```{r results='asis'}
plot_cluster(results_all$elsoc_2019$class2$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2019$class2$clust$desc.var$category)
```

:::

## ELSOC 2022

::: panel-tabset
# MCA

```{r}
plot_mca(results_all$elsoc_2022$class6$acm)
```

# Class 6

```{r results='asis'}
plot_cluster(results_all$elsoc_2022$class6$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category)
```

```{r}
e22c6c1 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 1)
e22c6c2 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 2)
e22c6c3 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 3)
e22c6c4 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 4)
e22c6c5 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 5)
e22c6c6 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e22c6c1$categoria[[1]]`** (*v_test = `r e22c6c1$v.test[[1]]`*); **`r e22c6c1$categoria[[2]]`** (*v_test = `r e22c6c1$v.test[[2]]`*) and **`r e22c6c1$categoria[[3]]`** (*v_test = `r e22c6c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e22c6c2$categoria[[1]]`** (*v_test = `r e22c6c2$v.test[[1]]`*); **`r e22c6c2$categoria[[2]]`** (*v_test = `r e22c6c2$v.test[[2]]`*) and **`r e22c6c2$categoria[[3]]`** (*v_test = `r e22c6c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e22c6c3$categoria[[1]]`** (*v_test = `r e22c6c3$v.test[[1]]`*); **`r e22c6c3$categoria[[2]]`** (*v_test = `r e22c6c3$v.test[[2]]`*) and **`r e22c6c3$categoria[[3]]`** (*v_test = `r e22c6c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e22c6c4$categoria[[1]]`** (*v_test = `r e22c6c4$v.test[[1]]`*); **`r e22c6c4$categoria[[2]]`** (*v_test = `r e22c6c4$v.test[[2]]`*) and **`r e22c6c4$categoria[[3]]`** (*v_test = `r e22c6c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e22c6c5$categoria[[1]]`** (*v_test = `r e22c6c5$v.test[[1]]`*); **`r e22c6c5$categoria[[2]]`** (*v_test = `r e22c6c5$v.test[[2]]`*) and **`r e22c6c5$categoria[[3]]`** (*v_test = `r e22c6c5$v.test[[3]]`*)

- Cluster 6 is characterized by an overrepresentation of: **`r e22c6c6$categoria[[1]]`** (*v_test = `r e22c6c6$v.test[[1]]`*); **`r e22c6c6$categoria[[2]]`** (*v_test = `r e22c6c6$v.test[[2]]`*) and **`r e22c6c6$categoria[[3]]`** (*v_test = `r e22c6c6$v.test[[3]]`*)

# Class 5

```{r results='asis'}
plot_cluster(results_all$elsoc_2022$class5$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2022$class5$clust$desc.var$category)
```

```{r}
e22c5c1 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 1)
e22c5c2 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 2)
e22c5c3 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 3)
e22c5c4 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 4)
e22c5c5 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 5)
e22c5c6 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% filter(cluster == 6)
```

- Cluster 1 is characterized by an overrepresentation of: **`r e22c5c1$categoria[[1]]`** (*v_test = `r e22c5c1$v.test[[1]]`*); **`r e22c5c1$categoria[[2]]`** (*v_test = `r e22c5c1$v.test[[2]]`*) and **`r e22c5c1$categoria[[3]]`** (*v_test = `r e22c5c1$v.test[[3]]`*)

- Cluster 2 is characterized by an overrepresentation of: **`r e22c5c2$categoria[[1]]`** (*v_test = `r e22c5c2$v.test[[1]]`*); **`r e22c5c2$categoria[[2]]`** (*v_test = `r e22c5c2$v.test[[2]]`*) and **`r e22c5c2$categoria[[3]]`** (*v_test = `r e22c5c2$v.test[[3]]`*)

- Cluster 3 is characterized by an overrepresentation of: **`r e22c5c3$categoria[[1]]`** (*v_test = `r e22c5c3$v.test[[1]]`*); **`r e22c5c3$categoria[[2]]`** (*v_test = `r e22c5c3$v.test[[2]]`*) and **`r e22c5c3$categoria[[3]]`** (*v_test = `r e22c5c3$v.test[[3]]`*)

- Cluster 4 is characterized by an overrepresentation of: **`r e22c5c4$categoria[[1]]`** (*v_test = `r e22c5c4$v.test[[1]]`*); **`r e22c5c4$categoria[[2]]`** (*v_test = `r e22c5c4$v.test[[2]]`*) and **`r e22c5c4$categoria[[3]]`** (*v_test = `r e22c5c4$v.test[[3]]`*)

- Cluster 5 is characterized by an overrepresentation of: **`r e22c5c5$categoria[[1]]`** (*v_test = `r e22c5c5$v.test[[1]]`*); **`r e22c5c5$categoria[[2]]`** (*v_test = `r e22c5c5$v.test[[2]]`*) and **`r e22c5c5$categoria[[3]]`** (*v_test = `r e22c5c5$v.test[[3]]`*)

# Class 4

```{r results='asis'}
plot_cluster(results_all$elsoc_2022$class4$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2022$class5$clust$desc.var$category)
```

# Class 3

```{r results='asis'}
plot_cluster(results_all$elsoc_2022$class3$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2022$class3$clust$desc.var$category)
```

# Class 2

```{r results='asis'}
plot_cluster(results_all$elsoc_2022$class2$clust)
```

```{r}
tab_desc_clust(results_all$elsoc_2022$class2$clust$desc.var$category)
```

:::

# Desc comparisson between class 6 of elsocs

```{r}

e16c6 <- process_tab_desc_clust(results_all$elsoc_2016$class6$clust$desc.var$category) %>% select(cluster, cat_w01 = categoria, vt_w01 = v.test) %>% group_by(cluster)  %>% slice_head(n = 5) %>% ungroup()
e19c6 <- process_tab_desc_clust(results_all$elsoc_2019$class6$clust$desc.var$category) %>% select(cluster, cat_w04 = categoria, vt_w04 =  v.test) %>% group_by(cluster) %>% slice_head(n = 5) %>% ungroup()
e22c6 <- process_tab_desc_clust(results_all$elsoc_2022$class6$clust$desc.var$category) %>% select(cluster, cat_w06 = categoria, vt_w06 =  v.test) %>% group_by(cluster) %>% slice_head(n = 5) %>% ungroup()
 
tabs <- bind_cols(list(e16c6, e19c6[, -1], e22c6[,-1]))

tabs %>%
  kable(
    caption = "HCPC Desc comparison between waves (first five per cluster)"
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE
  ) %>% 
  row_spec(0, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(5, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(10, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(15, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(20, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(25, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(30, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  specific_col(data = tabs, n = 3) %>% 
  specific_col(data = tabs, n = 5) %>% 
  specific_col(data = tabs, n = 7)


```

# Desc comparisson between class 5 of elsocs

```{r}

e16c5 <- process_tab_desc_clust(results_all$elsoc_2016$class5$clust$desc.var$category) %>% select(cluster, cat_w01 = categoria, vt_w01 = v.test) %>% group_by(cluster)  %>% slice_head(n = 5) %>% ungroup()
e19c5 <- process_tab_desc_clust(results_all$elsoc_2019$class5$clust$desc.var$category) %>% select(cluster, cat_w04 = categoria, vt_w04 =  v.test) %>% group_by(cluster) %>% slice_head(n = 5) %>% ungroup()
e22c5 <- process_tab_desc_clust(results_all$elsoc_2022$class5$clust$desc.var$category) %>% select(cluster, cat_w06 = categoria, vt_w06 =  v.test) %>% group_by(cluster) %>% slice_head(n = 5) %>% ungroup()
 
tabs <- bind_cols(list(e16c5, e19c5[, -1], e22c5[,-1]))

tabs %>%
  kable(
    caption = "HCPC Desc comparison between waves (first five per cluster)"
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE
  ) %>% 
  row_spec(0, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(5, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(10, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(15, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(20, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  row_spec(25, extra_css = paste0("border-bottom: ", 2.5, "px solid ", "black", ";")) %>% 
  specific_col(data = tabs, n = 3) %>% 
  specific_col(data = tabs, n = 5) %>% 
  specific_col(data = tabs, n = 7)

```


# N per cluster

::: panel-tabset

## Cluster 6
```{r}
wrap_tab_n_clust("class6") %>% 
  format_kable(title = "Sample frequencies per cluster - Class 6") %>% 
  format_lines()
```

## Cluster 5
```{r}
wrap_tab_n_clust("class5") %>% 
  format_kable(title = "Sample frequencies per cluster - Class 5") %>% 
  format_lines()
```

## Cluster 4
```{r}
wrap_tab_n_clust("class4") %>% 
  format_kable(title = "Sample frequencies per cluster - Class 4") %>% 
  format_lines()
```

## Cluster 3
```{r}
wrap_tab_n_clust("class3") %>% 
  format_kable(title = "Sample frequencies per cluster - Class 3") %>% 
  format_lines()
```

## Cluster 2
```{r}
wrap_tab_n_clust("class2") %>% 
  format_kable(title = "Sample frequencies per cluster - Class 2") %>% 
  format_lines()
```

:::